<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="flex justify-between items-start mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-800"><%= @voice_record.title %></h1>
        <p class="text-gray-600 mt-2">
          <span class="font-medium"><%= @voice_record.user_name %></span> â€¢ 
          <%= @voice_record.recorded_at.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") %>
        </p>
        
        <div class="mt-3 flex space-x-2">
          <% if @voice_record.transcribed? %>
            <span class="bg-green-100 text-green-800 text-sm px-2 py-1 rounded">éŸ³å£°èªè­˜æ¸ˆã¿</span>
          <% end %>
          <% if @voice_record.summarized? %>
            <span class="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded">è¦ç´„æ¸ˆã¿</span>
          <% end %>
        </div>
      </div>
      
      <div class="flex space-x-3">
        <%= link_to "ç·¨é›†", edit_voice_record_path(@voice_record), 
            class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        <%= link_to "å‰Šé™¤", @voice_record, method: :delete, 
            confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ", 
            class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" %>
        <%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", voice_records_path, 
            class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>
      </div>
    </div>

    <!-- è©±è€…æƒ…å ± -->
    <% if @voice_record.speakers.present? %>
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">è©±è€…</h3>
        <div class="flex flex-wrap gap-2">
          <% @voice_record.speakers_list.each do |speaker| %>
            <span class="bg-purple-100 text-purple-800 text-sm px-3 py-1 rounded-full"><%= speaker %></span>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- éŸ³å£°èªè­˜ãƒ†ã‚­ã‚¹ãƒˆ -->
    <% if @voice_record.original_text.present? %>
      <div class="mb-8">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-semibold text-gray-800">éŸ³å£°èªè­˜ãƒ†ã‚­ã‚¹ãƒˆ</h3>
          <button onclick="copyToClipboard('original-text')" 
                  class="bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm px-3 py-1 rounded">
            ğŸ“‹ ã‚³ãƒ”ãƒ¼
          </button>
        </div>
        <div id="original-text" class="bg-gray-50 rounded-lg p-4 border">
          <p class="text-gray-800 leading-relaxed whitespace-pre-wrap"><%= @voice_record.original_text %></p>
        </div>
      </div>
    <% end %>

    <!-- è¦ç´„ -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-semibold text-gray-800">è¦ç´„</h3>
        <div class="flex space-x-2">
          <% if @voice_record.summary_text.present? %>
            <button onclick="copyToClipboard('summary-text')" 
                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm px-3 py-1 rounded">
              ğŸ“‹ è¦ç´„ã‚’ã‚³ãƒ”ãƒ¼
            </button>
            <button onclick="copyNotionFormat()" 
                    class="bg-blue-100 hover:bg-blue-200 text-blue-700 text-sm px-3 py-1 rounded">
              ğŸ“ Notionå½¢å¼ã§ã‚³ãƒ”ãƒ¼
            </button>
          <% end %>
          <% unless @voice_record.summarized? %>
            <button onclick="generateSummary()" 
                    class="bg-green-500 hover:bg-green-700 text-white text-sm px-3 py-1 rounded">
              ğŸ¤– AIè¦ç´„ç”Ÿæˆ
            </button>
          <% end %>
        </div>
      </div>
      
      <% if @voice_record.summary_text.present? %>
        <div id="summary-text" class="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <p class="text-gray-800 leading-relaxed whitespace-pre-wrap"><%= @voice_record.summary_text %></p>
        </div>
      <% else %>
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
          <p class="text-gray-500 text-center">ã¾ã è¦ç´„ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
          <% if @voice_record.original_text.present? %>
            <p class="text-sm text-gray-400 text-center mt-2">
              ã€ŒAIè¦ç´„ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¦ç´„ã‚’ä½œæˆã§ãã¾ã™ã€‚
            </p>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Notionç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¡¨ç¤º -->
    <div id="notion-format" class="hidden mb-8">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-semibold text-gray-800">Notionç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
        <button onclick="copyToClipboard('notion-content')" 
                class="bg-green-100 hover:bg-green-200 text-green-700 text-sm px-3 py-1 rounded">
          ğŸ“‹ Notionå½¢å¼ã‚’ã‚³ãƒ”ãƒ¼
        </button>
      </div>
      <div id="notion-content" class="bg-green-50 rounded-lg p-4 border border-green-200">
        <pre class="text-sm text-gray-800 whitespace-pre-wrap" id="notion-text"></pre>
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard(elementId) {
  const element = document.getElementById(elementId);
  const text = element.innerText || element.textContent;
  
  navigator.clipboard.writeText(text).then(function() {
    // æˆåŠŸæ™‚ã®è¡¨ç¤º
    showMessage('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
  }, function(err) {
    // å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', err);
    showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
  });
}

function copyNotionFormat() {
  const title = '<%= @voice_record.title %>';
  const date = '<%= @voice_record.recorded_at.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") %>';
  const speakers = '<%= @voice_record.speakers_list.join(", ") if @voice_record.speakers.present? %>';
  const summary = '<%= j(@voice_record.summary_text) if @voice_record.summary_text.present? %>';
  
  let notionText = `# ${title}\n\n`;
  notionText += `**æ—¥æ™‚:** ${date}\n`;
  if (speakers) {
    notionText += `**è©±è€…:** ${speakers}\n`;
  }
  notionText += `\n## è¦ç´„\n${summary}`;
  
  document.getElementById('notion-text').textContent = notionText;
  document.getElementById('notion-format').classList.remove('hidden');
  
  navigator.clipboard.writeText(notionText).then(function() {
    showMessage('Notionå½¢å¼ã§ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
  }, function(err) {
    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', err);
    showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
  });
}

function generateSummary() {
  // AIè¦ç´„ç”Ÿæˆæ©Ÿèƒ½ã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…
  alert('AIè¦ç´„ç”Ÿæˆæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ã€‚\næ‰‹å‹•ã§ç·¨é›†ç”»é¢ã‹ã‚‰è¦ç´„ã‚’å…¥åŠ›ã§ãã¾ã™ã€‚');
}

function showMessage(message, type) {
  // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é¢¨ã®è¡¨ç¤º
  const messageDiv = document.createElement('div');
  messageDiv.className = `fixed top-4 right-4 px-4 py-2 rounded z-50 ${
    type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
  }`;
  messageDiv.textContent = message;
  
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.remove();
  }, 3000);
}
</script>
